{"version":3,"file":"ledgerjs.js","mappings":"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","sources":["webpack://[name]/external commonjs \"@ledgerhq/errors\"","webpack://[name]/external commonjs \"buffer\"","webpack://[name]/webpack/bootstrap","webpack://[name]/webpack/runtime/compat get default export","webpack://[name]/webpack/runtime/define property getters","webpack://[name]/webpack/runtime/hasOwnProperty shorthand","webpack://[name]/webpack/runtime/make namespace object","webpack://[name]/external commonjs \"invariant\"","webpack://[name]/external commonjs \"bs58check\"","webpack://[name]/external commonjs \"blake2b\"","webpack://[name]/./packages/hw-app-tezos/lib-es/Tezos.js","webpack://[name]/external commonjs \"events\"","webpack://[name]/./packages/hw-transport/lib-es/Transport.js","webpack://[name]/external commonjs \"@ledgerhq/hw-transport\"","webpack://[name]/external commonjs \"@ledgerhq/devices/lib/ble/sendAPDU\"","webpack://[name]/external commonjs \"@ledgerhq/devices/lib/ble/receiveAPDU\"","webpack://[name]/external commonjs \"@ledgerhq/logs\"","webpack://[name]/external commonjs \"rxjs\"","webpack://[name]/external commonjs \"rxjs/operators\"","webpack://[name]/external commonjs \"@abandonware/noble\"","webpack://[name]/external commonjs \"@ledgerhq/devices\"","webpack://[name]/./packages/hw-transport-node-ble/lib-es/platform.js","webpack://[name]/./packages/hw-transport-node-ble/lib-es/TransportNodeBle.js","webpack://[name]/./packages/errors/lib-es/helpers.js","webpack://[name]/./packages/errors/lib-es/index.js","webpack://[name]/external commonjs \"semver\"","webpack://[name]/./packages/devices/lib-es/index.js"],"sourcesContent":["module.exports = require(\"@ledgerhq/errors\");","module.exports = require(\"buffer\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"invariant\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"bs58check\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"blake2b\");","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\n/********************************************************************************\n *   Ledger Node JS API\n *   (c) 2016-2017 Ledger\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n ********************************************************************************/\nimport invariant from \"invariant\";\nimport bs58check from \"bs58check\";\nimport blake2b from \"blake2b\";\nexport var TezosCurves = {\n    ED25519: 0x00,\n    SECP256K1: 0x01,\n    SECP256R1: 0x02\n};\n/**\n * Tezos API\n *\n * @example\n * import Tezos from \"@ledgerhq/hw-app-tezos\";\n * const tez = new Tezos(transport)\n */\nvar Tezos = /** @class */ (function () {\n    function Tezos(transport) {\n        this.transport = transport;\n        transport.decorateAppAPIMethods(this, [\"getAddress\", \"signOperation\", \"getVersion\"], \"XTZ\");\n    }\n    /**\n     * get Tezos address for a given BIP 32 path.\n     * @param path a path in BIP 32 format, must begin with 44'/1729'\n     * @option options.verify optionally enable or not the display\n     * @option options.curve\n     * @option options.ins to use a custom apdu. This should currently only be unset (which will choose\n               an appropriate APDU based on the boolDisplay parameter), or else set to 0x0A\n               for the special \"display\" APDU which uses the alternate copy \"Your Key\"\n     * @return an object with address, publicKey\n     * @example\n     * tez.getAddress(\"44'/1729'/0'/0'\").then(o => o.address)\n     * tez.getAddress(\"44'/1729'/0'/0'\", { verify: true })\n     */\n    Tezos.prototype.getAddress = function (path, options) {\n        if (options === void 0) { options = {}; }\n        return __awaiter(this, void 0, void 0, function () {\n            var cla, ins, p1, p2, paths, buffer, payload, publicKeyLength, publicKey, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        cla = 0x80;\n                        ins = options.ins;\n                        if (!ins) {\n                            if (options.verify) {\n                                ins = 0x03;\n                            }\n                            else {\n                                ins = 0x02;\n                            }\n                        }\n                        p1 = 0;\n                        p2 = options.curve || 0;\n                        paths = splitPath(path);\n                        buffer = Buffer.alloc(1 + paths.length * 4);\n                        buffer[0] = paths.length;\n                        paths.forEach(function (element, index) {\n                            buffer.writeUInt32BE(element, 1 + 4 * index);\n                        });\n                        return [4 /*yield*/, this.transport.send(cla, ins, p1, p2, buffer)];\n                    case 1:\n                        payload = _a.sent();\n                        publicKeyLength = payload[0];\n                        if (!publicKeyLength) {\n                            // it seems to be a bug that apps returns empty answer\n                            throw new Error(\"invalid public key\");\n                        }\n                        publicKey = payload.slice(1, 1 + publicKeyLength);\n                        res = {\n                            publicKey: publicKey.toString(\"hex\"),\n                            address: encodeAddress(publicKey, p2)\n                        };\n                        return [2 /*return*/, res];\n                }\n            });\n        });\n    };\n    Tezos.prototype.signOperation = function (path, rawTxHex, options) {\n        if (options === void 0) { options = {}; }\n        return __awaiter(this, void 0, void 0, function () {\n            var curve, paths, offset, rawTx, toSend, buffer_1, maxChunkSize, chunkSize, buffer, response, i, data, code, signature;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        curve = options.curve || 0;\n                        paths = splitPath(path);\n                        offset = 0;\n                        rawTx = Buffer.from(rawTxHex, \"hex\");\n                        toSend = [];\n                        // Initial key setting\n                        {\n                            buffer_1 = Buffer.alloc(paths.length * 4 + 1);\n                            buffer_1[0] = paths.length;\n                            paths.forEach(function (element, index) {\n                                buffer_1.writeUInt32BE(element, 1 + 4 * index);\n                            });\n                            toSend.push(buffer_1);\n                        }\n                        while (offset !== rawTx.length) {\n                            maxChunkSize = 230;\n                            chunkSize = void 0;\n                            if (offset + maxChunkSize >= rawTx.length) {\n                                chunkSize = rawTx.length - offset;\n                            }\n                            else {\n                                chunkSize = maxChunkSize;\n                            }\n                            buffer = Buffer.alloc(chunkSize);\n                            rawTx.copy(buffer, 0, offset, offset + chunkSize);\n                            toSend.push(buffer);\n                            offset += chunkSize;\n                        }\n                        i = 0;\n                        _a.label = 1;\n                    case 1:\n                        if (!(i < toSend.length)) return [3 /*break*/, 4];\n                        data = toSend[i];\n                        code = 0x01;\n                        if (i === 0) {\n                            code = 0x00;\n                        }\n                        else if (i === toSend.length - 1) {\n                            code = 0x81;\n                        }\n                        return [4 /*yield*/, this.transport.send(0x80, 0x04, code, curve, data)];\n                    case 2:\n                        response = _a.sent();\n                        _a.label = 3;\n                    case 3:\n                        i++;\n                        return [3 /*break*/, 1];\n                    case 4:\n                        invariant(response, \"hw-app-xtz: response is set\");\n                        signature = response.slice(0, response.length - 2).toString(\"hex\");\n                        return [2 /*return*/, {\n                                signature: signature\n                            }];\n                }\n            });\n        });\n    };\n    Tezos.prototype.getVersion = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, appFlag, major, minor, patch, bakingApp;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, this.transport.send(0x80, 0x00, 0x00, 0x00, Buffer.alloc(0))];\n                    case 1:\n                        _a = __read.apply(void 0, [_b.sent(), 4]), appFlag = _a[0], major = _a[1], minor = _a[2], patch = _a[3];\n                        bakingApp = appFlag === 1;\n                        return [2 /*return*/, {\n                                major: major,\n                                minor: minor,\n                                patch: patch,\n                                bakingApp: bakingApp\n                            }];\n                }\n            });\n        });\n    };\n    return Tezos;\n}());\nexport default Tezos;\n// TODO use bip32-path library\nfunction splitPath(path) {\n    var result = [];\n    var components = path.split(\"/\");\n    components.forEach(function (element) {\n        var number = parseInt(element, 10);\n        if (isNaN(number)) {\n            return; // FIXME shouldn't it throws instead?\n        }\n        if (element.length > 1 && element[element.length - 1] === \"'\") {\n            number += 0x80000000;\n        }\n        result.push(number);\n    });\n    return result;\n}\nvar compressPublicKeySECP256 = function (publicKey, curve) {\n    return Buffer.concat([\n        Buffer.from([curve, 0x02 + (publicKey[64] & 0x01)]),\n        publicKey.slice(1, 33),\n    ]);\n};\nvar curves = [\n    {\n        pkB58Prefix: Buffer.from([13, 15, 37, 217]),\n        pkhB58Prefix: Buffer.from([6, 161, 159]),\n        compressPublicKey: function (publicKey, curve) {\n            publicKey = publicKey.slice(0);\n            publicKey[0] = curve;\n            return publicKey;\n        }\n    },\n    {\n        pkB58Prefix: Buffer.from([3, 254, 226, 86]),\n        pkhB58Prefix: Buffer.from([6, 161, 161]),\n        compressPublicKey: compressPublicKeySECP256\n    },\n    {\n        pkB58Prefix: Buffer.from([3, 178, 139, 127]),\n        pkhB58Prefix: Buffer.from([6, 161, 164]),\n        compressPublicKey: compressPublicKeySECP256\n    },\n];\nvar encodeAddress = function (publicKey, curve) {\n    var curveData = curves[curve];\n    invariant(curveData, \"%s curve not supported\", curve);\n    var publicKeyBuf = curveData.compressPublicKey(publicKey, curve);\n    var key = publicKeyBuf.slice(1);\n    var keyHashSize = 20;\n    var hash = blake2b(keyHashSize);\n    hash.update(key);\n    hash.digest((hash = Buffer.alloc(keyHashSize)));\n    var address = bs58check.encode(Buffer.concat([curveData.pkhB58Prefix, hash]));\n    return address;\n};\n//# sourceMappingURL=Tezos.js.map","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"events\");","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nimport EventEmitter from \"events\";\nimport { TransportRaceCondition, TransportError, StatusCodes, getAltStatusMessage, TransportStatusError, } from \"@ledgerhq/errors\";\nexport { TransportError, TransportStatusError, StatusCodes, getAltStatusMessage, };\n/**\n * Transport defines the generic interface to share between node/u2f impl\n * A **Descriptor** is a parametric type that is up to be determined for the implementation.\n * it can be for instance an ID, an file path, a URL,...\n */\nvar Transport = /** @class */ (function () {\n    function Transport() {\n        var _this = this;\n        this.exchangeTimeout = 30000;\n        this.unresponsiveTimeout = 15000;\n        this.deviceModel = null;\n        this._events = new EventEmitter();\n        /**\n         * wrapper on top of exchange to simplify work of the implementation.\n         * @param cla\n         * @param ins\n         * @param p1\n         * @param p2\n         * @param data\n         * @param statusList is a list of accepted status code (shorts). [0x9000] by default\n         * @return a Promise of response buffer\n         */\n        this.send = function (cla, ins, p1, p2, data, statusList) {\n            if (data === void 0) { data = Buffer.alloc(0); }\n            if (statusList === void 0) { statusList = [StatusCodes.OK]; }\n            return __awaiter(_this, void 0, void 0, function () {\n                var response, sw;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            if (data.length >= 256) {\n                                throw new TransportError(\"data.length exceed 256 bytes limit. Got: \" + data.length, \"DataLengthTooBig\");\n                            }\n                            return [4 /*yield*/, this.exchange(Buffer.concat([\n                                    Buffer.from([cla, ins, p1, p2]),\n                                    Buffer.from([data.length]),\n                                    data,\n                                ]))];\n                        case 1:\n                            response = _a.sent();\n                            sw = response.readUInt16BE(response.length - 2);\n                            if (!statusList.some(function (s) { return s === sw; })) {\n                                throw new TransportStatusError(sw);\n                            }\n                            return [2 /*return*/, response];\n                    }\n                });\n            });\n        };\n        this.exchangeAtomicImpl = function (f) { return __awaiter(_this, void 0, void 0, function () {\n            var resolveBusy, busyPromise, unresponsiveReached, timeout, res;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.exchangeBusyPromise) {\n                            throw new TransportRaceCondition(\"An action was already pending on the Ledger device. Please deny or reconnect.\");\n                        }\n                        busyPromise = new Promise(function (r) {\n                            resolveBusy = r;\n                        });\n                        this.exchangeBusyPromise = busyPromise;\n                        unresponsiveReached = false;\n                        timeout = setTimeout(function () {\n                            unresponsiveReached = true;\n                            _this.emit(\"unresponsive\");\n                        }, this.unresponsiveTimeout);\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, , 3, 4]);\n                        return [4 /*yield*/, f()];\n                    case 2:\n                        res = _a.sent();\n                        if (unresponsiveReached) {\n                            this.emit(\"responsive\");\n                        }\n                        return [2 /*return*/, res];\n                    case 3:\n                        clearTimeout(timeout);\n                        if (resolveBusy)\n                            resolveBusy();\n                        this.exchangeBusyPromise = null;\n                        return [7 /*endfinally*/];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        }); };\n        this._appAPIlock = null;\n    }\n    /**\n     * low level api to communicate with the device\n     * This method is for implementations to implement but should not be directly called.\n     * Instead, the recommanded way is to use send() method\n     * @param apdu the data to send\n     * @return a Promise of response data\n     */\n    Transport.prototype.exchange = function (_apdu) {\n        throw new Error(\"exchange not implemented\");\n    };\n    /**\n     * set the \"scramble key\" for the next exchanges with the device.\n     * Each App can have a different scramble key and they internally will set it at instanciation.\n     * @param key the scramble key\n     */\n    Transport.prototype.setScrambleKey = function (_key) { };\n    /**\n     * close the exchange with the device.\n     * @return a Promise that ends when the transport is closed.\n     */\n    Transport.prototype.close = function () {\n        return Promise.resolve();\n    };\n    /**\n     * Listen to an event on an instance of transport.\n     * Transport implementation can have specific events. Here is the common events:\n     * * `\"disconnect\"` : triggered if Transport is disconnected\n     */\n    Transport.prototype.on = function (eventName, cb) {\n        this._events.on(eventName, cb);\n    };\n    /**\n     * Stop listening to an event on an instance of transport.\n     */\n    Transport.prototype.off = function (eventName, cb) {\n        this._events.removeListener(eventName, cb);\n    };\n    Transport.prototype.emit = function (event) {\n        var _a;\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        (_a = this._events).emit.apply(_a, __spreadArray([event], __read(args), false));\n    };\n    /**\n     * Enable or not logs of the binary exchange\n     */\n    Transport.prototype.setDebugMode = function () {\n        console.warn(\"setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.\");\n    };\n    /**\n     * Set a timeout (in milliseconds) for the exchange call. Only some transport might implement it. (e.g. U2F)\n     */\n    Transport.prototype.setExchangeTimeout = function (exchangeTimeout) {\n        this.exchangeTimeout = exchangeTimeout;\n    };\n    /**\n     * Define the delay before emitting \"unresponsive\" on an exchange that does not respond\n     */\n    Transport.prototype.setExchangeUnresponsiveTimeout = function (unresponsiveTimeout) {\n        this.unresponsiveTimeout = unresponsiveTimeout;\n    };\n    /**\n     * create() allows to open the first descriptor available or\n     * throw if there is none or if timeout is reached.\n     * This is a light helper, alternative to using listen() and open() (that you may need for any more advanced usecase)\n     * @example\n    TransportFoo.create().then(transport => ...)\n     */\n    Transport.create = function (openTimeout, listenTimeout) {\n        var _this = this;\n        if (openTimeout === void 0) { openTimeout = 3000; }\n        return new Promise(function (resolve, reject) {\n            var found = false;\n            var sub = _this.listen({\n                next: function (e) {\n                    found = true;\n                    if (sub)\n                        sub.unsubscribe();\n                    if (listenTimeoutId)\n                        clearTimeout(listenTimeoutId);\n                    _this.open(e.descriptor, openTimeout).then(resolve, reject);\n                },\n                error: function (e) {\n                    if (listenTimeoutId)\n                        clearTimeout(listenTimeoutId);\n                    reject(e);\n                },\n                complete: function () {\n                    if (listenTimeoutId)\n                        clearTimeout(listenTimeoutId);\n                    if (!found) {\n                        reject(new TransportError(_this.ErrorMessage_NoDeviceFound, \"NoDeviceFound\"));\n                    }\n                }\n            });\n            var listenTimeoutId = listenTimeout\n                ? setTimeout(function () {\n                    sub.unsubscribe();\n                    reject(new TransportError(_this.ErrorMessage_ListenTimeout, \"ListenTimeout\"));\n                }, listenTimeout)\n                : null;\n        });\n    };\n    Transport.prototype.decorateAppAPIMethods = function (self, methods, scrambleKey) {\n        var e_1, _a;\n        try {\n            for (var methods_1 = __values(methods), methods_1_1 = methods_1.next(); !methods_1_1.done; methods_1_1 = methods_1.next()) {\n                var methodName = methods_1_1.value;\n                self[methodName] = this.decorateAppAPIMethod(methodName, self[methodName], self, scrambleKey);\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (methods_1_1 && !methods_1_1.done && (_a = methods_1[\"return\"])) _a.call(methods_1);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n    };\n    Transport.prototype.decorateAppAPIMethod = function (methodName, f, ctx, scrambleKey) {\n        var _this = this;\n        return function () {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            return __awaiter(_this, void 0, void 0, function () {\n                var _appAPIlock;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            _appAPIlock = this._appAPIlock;\n                            if (_appAPIlock) {\n                                return [2 /*return*/, Promise.reject(new TransportError(\"Ledger Device is busy (lock \" + _appAPIlock + \")\", \"TransportLocked\"))];\n                            }\n                            _a.label = 1;\n                        case 1:\n                            _a.trys.push([1, , 3, 4]);\n                            this._appAPIlock = methodName;\n                            this.setScrambleKey(scrambleKey);\n                            return [4 /*yield*/, f.apply(ctx, args)];\n                        case 2: return [2 /*return*/, _a.sent()];\n                        case 3:\n                            this._appAPIlock = null;\n                            return [7 /*endfinally*/];\n                        case 4: return [2 /*return*/];\n                    }\n                });\n            });\n        };\n    };\n    Transport.ErrorMessage_ListenTimeout = \"No Ledger device found (timeout)\";\n    Transport.ErrorMessage_NoDeviceFound = \"No Ledger device found\";\n    return Transport;\n}());\nexport default Transport;\n//# sourceMappingURL=Transport.js.map","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@ledgerhq/hw-transport\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@ledgerhq/devices/lib/ble/sendAPDU\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@ledgerhq/devices/lib/ble/receiveAPDU\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@ledgerhq/logs\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"rxjs\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"rxjs/operators\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@abandonware/noble\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@ledgerhq/devices\");","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nimport noble from \"@abandonware/noble\";\nimport { Observable } from \"rxjs\";\nimport { log } from \"@ledgerhq/logs\";\nimport { getInfosForServiceUuid, getBluetoothServiceUuids, } from \"@ledgerhq/devices\";\nimport { TransportError } from \"@ledgerhq/errors\";\nnoble.on(\"warning\", function (message) {\n    log(\"ble-warning\", message);\n});\nvar POWERED_ON = \"poweredOn\";\nexport var availability = Observable.create(function (observer) {\n    var onAvailabilityChanged = function (e) {\n        observer.next(e === POWERED_ON);\n    };\n    noble.on(\"stateChanged\", onAvailabilityChanged); // events lib?\n    observer.next(noble.state === POWERED_ON);\n    return function () {\n        noble.removeListener(\"stateChanged\", onAvailabilityChanged);\n    };\n});\nexport var listenDeviceDisconnect = function (device, onDisconnect) {\n    device.addListener(\"disconnect\", onDisconnect);\n    return function () {\n        device.removeListener(\"disconnect\", onDisconnect);\n    };\n};\nexport var connectDevice = function (device) {\n    return new Promise(function (resolve, reject) {\n        device.connect(function (error) {\n            if (error) {\n                reject(error);\n            }\n            else {\n                resolve();\n            }\n        });\n    });\n};\nexport var disconnectDevice = function (device) {\n    return new Promise(function (resolve, reject) {\n        device.disconnect(function (error) {\n            if (error) {\n                reject(error);\n            }\n            else {\n                resolve();\n            }\n        });\n    });\n};\nexport var isDeviceDisconnected = function (device) {\n    return device.state === \"disconnected\";\n};\nvar discoverDeviceServices = function (device) {\n    return new Promise(function (resolve, reject) {\n        return device.discoverServices(null, function (error, services) {\n            if (error)\n                reject(error);\n            else\n                resolve(services);\n        });\n    });\n};\nvar discoverServiceCharacteristics = function (service) {\n    return new Promise(function (resolve, reject) {\n        return service.discoverCharacteristics(null, function (error, chs) {\n            if (error)\n                reject(error);\n            else\n                resolve(chs);\n        });\n    });\n};\nexport var listen = function () {\n    return Observable.create(function (observer) {\n        var discoveredDevices = {};\n        var onDiscover = function (peripheral) {\n            var id = peripheral.uuid;\n            var localName = peripheral.advertisement.localName;\n            var name = localName ||\n                (discoveredDevices[id] ? discoveredDevices[id].name : null);\n            discoveredDevices[id] = {\n                peripheral: peripheral,\n                name: name\n            };\n            log(\"ble-advertisement\", id + \" (\" + String(name) + \")\");\n            observer.next({\n                type: \"add\",\n                descriptor: peripheral,\n                device: {\n                    id: id,\n                    name: name\n                }\n            });\n        };\n        noble.on(\"discover\", onDiscover);\n        noble.startScanning(getBluetoothServiceUuids(), true);\n        return function () {\n            noble.removeListener(\"discover\", onDiscover);\n            noble.stopScanning();\n        };\n    });\n};\nexport var retrieveServiceAndCharacteristics = function (device) { return __awaiter(void 0, void 0, void 0, function () {\n    var _a, service, infos, characteristics, writeC, notifyC, characteristics_1, characteristics_1_1, c;\n    var e_1, _b;\n    return __generator(this, function (_c) {\n        switch (_c.label) {\n            case 0: return [4 /*yield*/, discoverDeviceServices(device)];\n            case 1:\n                _a = __read.apply(void 0, [_c.sent(), 1]), service = _a[0];\n                infos = getInfosForServiceUuid(service.uuid);\n                if (!infos) {\n                    throw new TransportError(\"service not found\", \"BLEServiceNotFound\");\n                }\n                return [4 /*yield*/, discoverServiceCharacteristics(service)];\n            case 2:\n                characteristics = _c.sent();\n                try {\n                    for (characteristics_1 = __values(characteristics), characteristics_1_1 = characteristics_1.next(); !characteristics_1_1.done; characteristics_1_1 = characteristics_1.next()) {\n                        c = characteristics_1_1.value;\n                        if (c.uuid === infos.writeUuid.replace(/-/g, \"\")) {\n                            writeC = c;\n                        }\n                        else if (c.uuid === infos.notifyUuid.replace(/-/g, \"\")) {\n                            notifyC = c;\n                        }\n                    }\n                }\n                catch (e_1_1) { e_1 = { error: e_1_1 }; }\n                finally {\n                    try {\n                        if (characteristics_1_1 && !characteristics_1_1.done && (_b = characteristics_1[\"return\"])) _b.call(characteristics_1);\n                    }\n                    finally { if (e_1) throw e_1.error; }\n                }\n                if (!writeC || !notifyC) {\n                    throw new TransportError(\"missing characteristics\", \"BLEMissingCharacteristics\");\n                }\n                return [2 /*return*/, {\n                        writeC: writeC,\n                        notifyC: notifyC,\n                        deviceModel: infos.deviceModel\n                    }];\n        }\n    });\n}); };\nexport var monitorCharacteristic = function (characteristic) {\n    var resolve;\n    var reject;\n    var readyness = new Promise(function (res, rej) {\n        resolve = res;\n        reject = rej;\n    });\n    var observable = Observable.create(function (o) {\n        function onCharacteristicValueChanged(data) {\n            o.next(Buffer.from(data));\n        }\n        function onSubscribe(error) {\n            if (error) {\n                reject(error);\n                o.error(error);\n            }\n            else {\n                resolve();\n                log(\"verbose\", \"start monitor \" + characteristic.uuid);\n            }\n        }\n        characteristic.on(\"data\", onCharacteristicValueChanged);\n        characteristic.subscribe(onSubscribe);\n        return function () {\n            log(\"verbose\", \"end monitor \" + characteristic.uuid);\n            characteristic.removeListener(\"data\", onCharacteristicValueChanged);\n            characteristic.unsubscribe();\n        };\n    });\n    return [observable, readyness];\n};\nexport var write = function (writeCharacteristic, buffer) {\n    return new Promise(function (resolve, reject) {\n        writeCharacteristic.write(buffer, false, function (e) {\n            if (e)\n                reject(e);\n            else\n                resolve();\n        });\n    });\n};\n//# sourceMappingURL=platform.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nimport Transport from \"@ledgerhq/hw-transport\";\nimport { sendAPDU } from \"@ledgerhq/devices/lib/ble/sendAPDU\";\nimport { receiveAPDU } from \"@ledgerhq/devices/lib/ble/receiveAPDU\";\nimport { log } from \"@ledgerhq/logs\";\nimport { defer, merge, from } from \"rxjs\";\nimport { share, ignoreElements, first, map, tap } from \"rxjs/operators\";\nimport { CantOpenDevice, DisconnectedDeviceDuringOperation, } from \"@ledgerhq/errors\";\nimport { monitorCharacteristic, availability, retrieveServiceAndCharacteristics, write, disconnectDevice, listen, listenDeviceDisconnect, connectDevice, isDeviceDisconnected, } from \"./platform\";\nvar transportsCache = {};\nvar reconnectionConfig = {\n    pairingThreshold: 1000,\n    delayAfterFirstPairing: 4000\n};\nexport function setReconnectionConfig(config) {\n    reconnectionConfig = config;\n}\nvar delay = function (ms) { return new Promise(function (success) { return setTimeout(success, ms); }); };\nfunction open(deviceOrId, needsReconnect) {\n    return __awaiter(this, void 0, void 0, function () {\n        var device, _a, notifyC, writeC, deviceModel, _b, observable, monitoringReady, notifyObservable, notif, transport, onDisconnect, disconnectedSub, beforeMTUTime, afterMTUTime;\n        return __generator(this, function (_c) {\n            switch (_c.label) {\n                case 0:\n                    if (typeof deviceOrId === \"string\") {\n                        if (transportsCache[deviceOrId]) {\n                            log(\"ble-verbose\", \"Transport in cache, using that.\");\n                            return [2 /*return*/, transportsCache[deviceOrId]];\n                        }\n                    }\n                    else {\n                        device = deviceOrId;\n                    }\n                    if (!device) {\n                        throw new CantOpenDevice();\n                    }\n                    return [4 /*yield*/, availability.pipe(first(function (enabled) { return enabled; })).toPromise()];\n                case 1:\n                    _c.sent();\n                    if (!isDeviceDisconnected(device)) return [3 /*break*/, 3];\n                    log(\"ble-verbose\", \"not connected. connecting...\");\n                    return [4 /*yield*/, connectDevice(device)];\n                case 2:\n                    _c.sent();\n                    _c.label = 3;\n                case 3: return [4 /*yield*/, retrieveServiceAndCharacteristics(device)];\n                case 4:\n                    _a = _c.sent(), notifyC = _a.notifyC, writeC = _a.writeC, deviceModel = _a.deviceModel;\n                    _b = __read(monitorCharacteristic(notifyC), 2), observable = _b[0], monitoringReady = _b[1];\n                    notifyObservable = observable.pipe(tap(function (value) {\n                        log(\"ble-frame\", \"<= \" + value.toString(\"hex\"));\n                    }), share());\n                    notif = notifyObservable.subscribe();\n                    transport = new BluetoothTransport(device, writeC, notifyObservable, deviceModel);\n                    onDisconnect = function (e) {\n                        transport.notYetDisconnected = false;\n                        notif.unsubscribe();\n                        disconnectedSub();\n                        delete transportsCache[transport.id];\n                        log(\"ble-verbose\", \"BleTransport(\" + transport.id + \") disconnected\");\n                        transport.emit(\"disconnect\", e);\n                    };\n                    // eslint-disable-next-line require-atomic-updates\n                    transportsCache[transport.id] = transport;\n                    disconnectedSub = listenDeviceDisconnect(device, function (e) {\n                        if (!transport.notYetDisconnected)\n                            return;\n                        onDisconnect(e);\n                    });\n                    beforeMTUTime = Date.now();\n                    _c.label = 5;\n                case 5:\n                    _c.trys.push([5, , 8, 14]);\n                    return [4 /*yield*/, monitoringReady];\n                case 6:\n                    _c.sent();\n                    return [4 /*yield*/, transport.inferMTU()];\n                case 7:\n                    _c.sent();\n                    return [3 /*break*/, 14];\n                case 8:\n                    afterMTUTime = Date.now();\n                    if (!reconnectionConfig) return [3 /*break*/, 12];\n                    // workaround for #279: we need to open() again if we come the first time here,\n                    // to make sure we do a disconnect() after the first pairing time\n                    // because of a firmware bug\n                    if (afterMTUTime - beforeMTUTime < reconnectionConfig.pairingThreshold) {\n                        needsReconnect = false; // (optim) there is likely no new pairing done because mtu answer was fast.\n                    }\n                    if (!needsReconnect) return [3 /*break*/, 11];\n                    // necessary time for the bonding workaround\n                    return [4 /*yield*/, disconnectDevice(device)[\"catch\"](function () { })];\n                case 9:\n                    // necessary time for the bonding workaround\n                    _c.sent();\n                    return [4 /*yield*/, delay(reconnectionConfig.delayAfterFirstPairing)];\n                case 10:\n                    _c.sent();\n                    _c.label = 11;\n                case 11: return [3 /*break*/, 13];\n                case 12:\n                    needsReconnect = false;\n                    _c.label = 13;\n                case 13: return [7 /*endfinally*/];\n                case 14:\n                    if (needsReconnect) {\n                        return [2 /*return*/, open(device, false)];\n                    }\n                    return [2 /*return*/, transport];\n            }\n        });\n    });\n}\n/**\n * TransportNodeBle bluetooth BLE implementation\n * @example\n * import BluetoothTransport from \"@ledgerhq/hw-transport-node-ble\";\n */\nvar BluetoothTransport = /** @class */ (function (_super) {\n    __extends(BluetoothTransport, _super);\n    function BluetoothTransport(device, writeCharacteristic, notifyObservable, deviceModel) {\n        var _this = _super.call(this) || this;\n        _this.mtuSize = 20;\n        _this.notYetDisconnected = true;\n        /**\n         * communicate with a BLE transport\n         */\n        _this.exchange = function (apdu) {\n            return _this.exchangeAtomicImpl(function () { return __awaiter(_this, void 0, void 0, function () {\n                var msgIn, data, msgOut, e_1;\n                return __generator(this, function (_b) {\n                    switch (_b.label) {\n                        case 0:\n                            _b.trys.push([0, 2, , 5]);\n                            msgIn = apdu.toString(\"hex\");\n                            log(\"apdu\", \"=> \" + msgIn);\n                            return [4 /*yield*/, merge(this.notifyObservable.pipe(receiveAPDU), sendAPDU(this.write, apdu, this.mtuSize)).toPromise()];\n                        case 1:\n                            data = _b.sent();\n                            msgOut = data.toString(\"hex\");\n                            log(\"apdu\", \"<= \" + msgOut);\n                            return [2 /*return*/, data];\n                        case 2:\n                            e_1 = _b.sent();\n                            log(\"ble-error\", \"exchange got \" + String(e_1));\n                            if (!this.notYetDisconnected) return [3 /*break*/, 4];\n                            // in such case we will always disconnect because something is bad.\n                            return [4 /*yield*/, disconnectDevice(this.device)[\"catch\"](function () { })];\n                        case 3:\n                            // in such case we will always disconnect because something is bad.\n                            _b.sent(); // but we ignore if disconnect worked.\n                            _b.label = 4;\n                        case 4: throw e_1;\n                        case 5: return [2 /*return*/];\n                    }\n                });\n            }); });\n        };\n        _this.write = function (buffer) { return __awaiter(_this, void 0, void 0, function () {\n            var e_2;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        log(\"ble-frame\", \"=> \" + buffer.toString(\"hex\"));\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, write(this.writeCharacteristic, buffer)];\n                    case 2:\n                        _b.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        e_2 = _b.sent();\n                        throw new DisconnectedDeviceDuringOperation(e_2.message);\n                    case 4: return [2 /*return*/];\n                }\n            });\n        }); };\n        _this.id = device.id;\n        _this.device = device;\n        _this.writeCharacteristic = writeCharacteristic;\n        _this.notifyObservable = notifyObservable;\n        _this.deviceModel = deviceModel;\n        log(\"ble-verbose\", \"BleTransport(\" + String(_this.id) + \") new instance\");\n        return _this;\n    }\n    /**\n     * Scan for bluetooth Ledger devices\n     */\n    BluetoothTransport.listen = function (observer) {\n        log(\"ble-verbose\", \"listen...\");\n        return listen().subscribe(observer);\n    };\n    /**\n     * Open a BLE transport\n     * @param {*} deviceOrId\n     */\n    BluetoothTransport.open = function (deviceOrId) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_b) {\n                return [2 /*return*/, open(deviceOrId, true)];\n            });\n        });\n    };\n    // TODO we probably will do this at end of open\n    BluetoothTransport.prototype.inferMTU = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var mtu, mtuSize;\n            var _this = this;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        mtu = this.device.mtu;\n                        return [4 /*yield*/, this.exchangeAtomicImpl(function () { return __awaiter(_this, void 0, void 0, function () {\n                                var e_3;\n                                var _this = this;\n                                return __generator(this, function (_b) {\n                                    switch (_b.label) {\n                                        case 0:\n                                            _b.trys.push([0, 2, , 4]);\n                                            return [4 /*yield*/, merge(this.notifyObservable.pipe(first(function (buffer) { return buffer.readUInt8(0) === 0x08; }), map(function (buffer) { return buffer.readUInt8(5); })), defer(function () { return from(_this.write(Buffer.from([0x08, 0, 0, 0, 0]))); }).pipe(ignoreElements())).toPromise()];\n                                        case 1:\n                                            mtu =\n                                                (_b.sent()) + 3;\n                                            return [3 /*break*/, 4];\n                                        case 2:\n                                            e_3 = _b.sent();\n                                            log(\"ble-error\", \"inferMTU got \" + String(e_3));\n                                            return [4 /*yield*/, disconnectDevice(this.device)[\"catch\"](function () { })];\n                                        case 3:\n                                            _b.sent(); // but we ignore if disconnect worked.\n                                            throw e_3;\n                                        case 4: return [2 /*return*/];\n                                    }\n                                });\n                            }); })];\n                    case 1:\n                        _b.sent();\n                        if (mtu > 23) {\n                            mtuSize = mtu - 3;\n                            log(\"ble-verbose\", \"BleTransport(\" + String(this.id) + \") mtu set to \" + String(mtuSize));\n                            this.mtuSize = mtuSize;\n                        }\n                        return [2 /*return*/, this.mtuSize];\n                }\n            });\n        });\n    };\n    BluetoothTransport.prototype.setScrambleKey = function () { };\n    BluetoothTransport.prototype.close = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!this.exchangeBusyPromise) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.exchangeBusyPromise];\n                    case 1:\n                        _b.sent();\n                        _b.label = 2;\n                    case 2: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    var _a;\n    _a = BluetoothTransport;\n    /**\n     *\n     */\n    BluetoothTransport.isSupported = function () { return Promise.resolve(true); };\n    /**\n     *\n     */\n    BluetoothTransport.availability = availability;\n    BluetoothTransport.list = function () {\n        throw new Error(\"not implemented\");\n    };\n    /**\n     * Globally disconnect a BLE device by its ID\n     */\n    BluetoothTransport.disconnect = function (id) { return __awaiter(void 0, void 0, void 0, function () {\n        return __generator(_a, function (_b) {\n            log(\"ble-verbose\", \"user disconnect(\" + id + \")\");\n            if (id in transportsCache) {\n                disconnectDevice(transportsCache[id].device);\n            }\n            return [2 /*return*/];\n        });\n    }); };\n    return BluetoothTransport;\n}(Transport));\nexport default BluetoothTransport;\n//# sourceMappingURL=TransportNodeBle.js.map","/* eslint-disable no-continue */\n/* eslint-disable no-unused-vars */\n/* eslint-disable no-param-reassign */\n/* eslint-disable no-prototype-builtins */\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar errorClasses = {};\nvar deserializers = {};\nexport var addCustomErrorDeserializer = function (name, deserializer) {\n    deserializers[name] = deserializer;\n};\nexport var createCustomErrorClass = function (name) {\n    var C = function CustomError(message, fields) {\n        Object.assign(this, fields);\n        this.name = name;\n        this.message = message || name;\n        this.stack = new Error().stack;\n    };\n    C.prototype = new Error();\n    errorClasses[name] = C;\n    return C;\n};\n// inspired from https://github.com/programble/errio/blob/master/index.js\nexport var deserializeError = function (object) {\n    if (typeof object === \"object\" && object) {\n        try {\n            // $FlowFixMe FIXME HACK\n            var msg = JSON.parse(object.message);\n            if (msg.message && msg.name) {\n                object = msg;\n            }\n        }\n        catch (e) {\n            // nothing\n        }\n        var error = void 0;\n        if (typeof object.name === \"string\") {\n            var name_1 = object.name;\n            var des = deserializers[name_1];\n            if (des) {\n                error = des(object);\n            }\n            else {\n                var constructor = name_1 === \"Error\" ? Error : errorClasses[name_1];\n                if (!constructor) {\n                    console.warn(\"deserializing an unknown class '\" + name_1 + \"'\");\n                    constructor = createCustomErrorClass(name_1);\n                }\n                error = Object.create(constructor.prototype);\n                try {\n                    for (var prop in object) {\n                        if (object.hasOwnProperty(prop)) {\n                            error[prop] = object[prop];\n                        }\n                    }\n                }\n                catch (e) {\n                    // sometimes setting a property can fail (e.g. .name)\n                }\n            }\n        }\n        else {\n            error = new Error(object.message);\n        }\n        if (!error.stack && Error.captureStackTrace) {\n            Error.captureStackTrace(error, deserializeError);\n        }\n        return error;\n    }\n    return new Error(String(object));\n};\n// inspired from https://github.com/sindresorhus/serialize-error/blob/master/index.js\nexport var serializeError = function (value) {\n    if (!value)\n        return value;\n    if (typeof value === \"object\") {\n        return destroyCircular(value, []);\n    }\n    if (typeof value === \"function\") {\n        return \"[Function: \" + (value.name || \"anonymous\") + \"]\";\n    }\n    return value;\n};\n// https://www.npmjs.com/package/destroy-circular\nfunction destroyCircular(from, seen) {\n    var e_1, _a;\n    var to = {};\n    seen.push(from);\n    try {\n        for (var _b = __values(Object.keys(from)), _c = _b.next(); !_c.done; _c = _b.next()) {\n            var key = _c.value;\n            var value = from[key];\n            if (typeof value === \"function\") {\n                continue;\n            }\n            if (!value || typeof value !== \"object\") {\n                to[key] = value;\n                continue;\n            }\n            if (seen.indexOf(from[key]) === -1) {\n                to[key] = destroyCircular(from[key], seen.slice(0));\n                continue;\n            }\n            to[key] = \"[Circular]\";\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (_c && !_c.done && (_a = _b[\"return\"])) _a.call(_b);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    if (typeof from.name === \"string\") {\n        to.name = from.name;\n    }\n    if (typeof from.message === \"string\") {\n        to.message = from.message;\n    }\n    if (typeof from.stack === \"string\") {\n        to.stack = from.stack;\n    }\n    return to;\n}\n//# sourceMappingURL=helpers.js.map","import { serializeError, deserializeError, createCustomErrorClass, addCustomErrorDeserializer, } from \"./helpers\";\nexport { serializeError, deserializeError, createCustomErrorClass, addCustomErrorDeserializer, };\nexport var AccountNameRequiredError = createCustomErrorClass(\"AccountNameRequired\");\nexport var AccountNotSupported = createCustomErrorClass(\"AccountNotSupported\");\nexport var AmountRequired = createCustomErrorClass(\"AmountRequired\");\nexport var BluetoothRequired = createCustomErrorClass(\"BluetoothRequired\");\nexport var BtcUnmatchedApp = createCustomErrorClass(\"BtcUnmatchedApp\");\nexport var CantOpenDevice = createCustomErrorClass(\"CantOpenDevice\");\nexport var CashAddrNotSupported = createCustomErrorClass(\"CashAddrNotSupported\");\nexport var CurrencyNotSupported = createCustomErrorClass(\"CurrencyNotSupported\");\nexport var DeviceAppVerifyNotSupported = createCustomErrorClass(\"DeviceAppVerifyNotSupported\");\nexport var DeviceGenuineSocketEarlyClose = createCustomErrorClass(\"DeviceGenuineSocketEarlyClose\");\nexport var DeviceNotGenuineError = createCustomErrorClass(\"DeviceNotGenuine\");\nexport var DeviceOnDashboardExpected = createCustomErrorClass(\"DeviceOnDashboardExpected\");\nexport var DeviceOnDashboardUnexpected = createCustomErrorClass(\"DeviceOnDashboardUnexpected\");\nexport var DeviceInOSUExpected = createCustomErrorClass(\"DeviceInOSUExpected\");\nexport var DeviceHalted = createCustomErrorClass(\"DeviceHalted\");\nexport var DeviceNameInvalid = createCustomErrorClass(\"DeviceNameInvalid\");\nexport var DeviceSocketFail = createCustomErrorClass(\"DeviceSocketFail\");\nexport var DeviceSocketNoBulkStatus = createCustomErrorClass(\"DeviceSocketNoBulkStatus\");\nexport var DisconnectedDevice = createCustomErrorClass(\"DisconnectedDevice\");\nexport var DisconnectedDeviceDuringOperation = createCustomErrorClass(\"DisconnectedDeviceDuringOperation\");\nexport var EnpointConfigError = createCustomErrorClass(\"EnpointConfig\");\nexport var EthAppPleaseEnableContractData = createCustomErrorClass(\"EthAppPleaseEnableContractData\");\nexport var FeeEstimationFailed = createCustomErrorClass(\"FeeEstimationFailed\");\nexport var FirmwareNotRecognized = createCustomErrorClass(\"FirmwareNotRecognized\");\nexport var HardResetFail = createCustomErrorClass(\"HardResetFail\");\nexport var InvalidXRPTag = createCustomErrorClass(\"InvalidXRPTag\");\nexport var InvalidAddress = createCustomErrorClass(\"InvalidAddress\");\nexport var InvalidAddressBecauseDestinationIsAlsoSource = createCustomErrorClass(\"InvalidAddressBecauseDestinationIsAlsoSource\");\nexport var LatestMCUInstalledError = createCustomErrorClass(\"LatestMCUInstalledError\");\nexport var UnknownMCU = createCustomErrorClass(\"UnknownMCU\");\nexport var LedgerAPIError = createCustomErrorClass(\"LedgerAPIError\");\nexport var LedgerAPIErrorWithMessage = createCustomErrorClass(\"LedgerAPIErrorWithMessage\");\nexport var LedgerAPINotAvailable = createCustomErrorClass(\"LedgerAPINotAvailable\");\nexport var ManagerAppAlreadyInstalledError = createCustomErrorClass(\"ManagerAppAlreadyInstalled\");\nexport var ManagerAppRelyOnBTCError = createCustomErrorClass(\"ManagerAppRelyOnBTC\");\nexport var ManagerAppDepInstallRequired = createCustomErrorClass(\"ManagerAppDepInstallRequired\");\nexport var ManagerAppDepUninstallRequired = createCustomErrorClass(\"ManagerAppDepUninstallRequired\");\nexport var ManagerDeviceLockedError = createCustomErrorClass(\"ManagerDeviceLocked\");\nexport var ManagerFirmwareNotEnoughSpaceError = createCustomErrorClass(\"ManagerFirmwareNotEnoughSpace\");\nexport var ManagerNotEnoughSpaceError = createCustomErrorClass(\"ManagerNotEnoughSpace\");\nexport var ManagerUninstallBTCDep = createCustomErrorClass(\"ManagerUninstallBTCDep\");\nexport var NetworkDown = createCustomErrorClass(\"NetworkDown\");\nexport var NoAddressesFound = createCustomErrorClass(\"NoAddressesFound\");\nexport var NotEnoughBalance = createCustomErrorClass(\"NotEnoughBalance\");\nexport var NotEnoughBalanceToDelegate = createCustomErrorClass(\"NotEnoughBalanceToDelegate\");\nexport var NotEnoughBalanceInParentAccount = createCustomErrorClass(\"NotEnoughBalanceInParentAccount\");\nexport var NotEnoughSpendableBalance = createCustomErrorClass(\"NotEnoughSpendableBalance\");\nexport var NotEnoughBalanceBecauseDestinationNotCreated = createCustomErrorClass(\"NotEnoughBalanceBecauseDestinationNotCreated\");\nexport var NoAccessToCamera = createCustomErrorClass(\"NoAccessToCamera\");\nexport var NotEnoughGas = createCustomErrorClass(\"NotEnoughGas\");\nexport var NotSupportedLegacyAddress = createCustomErrorClass(\"NotSupportedLegacyAddress\");\nexport var GasLessThanEstimate = createCustomErrorClass(\"GasLessThanEstimate\");\nexport var PasswordsDontMatchError = createCustomErrorClass(\"PasswordsDontMatch\");\nexport var PasswordIncorrectError = createCustomErrorClass(\"PasswordIncorrect\");\nexport var RecommendSubAccountsToEmpty = createCustomErrorClass(\"RecommendSubAccountsToEmpty\");\nexport var RecommendUndelegation = createCustomErrorClass(\"RecommendUndelegation\");\nexport var TimeoutTagged = createCustomErrorClass(\"TimeoutTagged\");\nexport var UnexpectedBootloader = createCustomErrorClass(\"UnexpectedBootloader\");\nexport var MCUNotGenuineToDashboard = createCustomErrorClass(\"MCUNotGenuineToDashboard\");\nexport var RecipientRequired = createCustomErrorClass(\"RecipientRequired\");\nexport var UnavailableTezosOriginatedAccountReceive = createCustomErrorClass(\"UnavailableTezosOriginatedAccountReceive\");\nexport var UnavailableTezosOriginatedAccountSend = createCustomErrorClass(\"UnavailableTezosOriginatedAccountSend\");\nexport var UpdateFetchFileFail = createCustomErrorClass(\"UpdateFetchFileFail\");\nexport var UpdateIncorrectHash = createCustomErrorClass(\"UpdateIncorrectHash\");\nexport var UpdateIncorrectSig = createCustomErrorClass(\"UpdateIncorrectSig\");\nexport var UpdateYourApp = createCustomErrorClass(\"UpdateYourApp\");\nexport var UserRefusedDeviceNameChange = createCustomErrorClass(\"UserRefusedDeviceNameChange\");\nexport var UserRefusedAddress = createCustomErrorClass(\"UserRefusedAddress\");\nexport var UserRefusedFirmwareUpdate = createCustomErrorClass(\"UserRefusedFirmwareUpdate\");\nexport var UserRefusedAllowManager = createCustomErrorClass(\"UserRefusedAllowManager\");\nexport var UserRefusedOnDevice = createCustomErrorClass(\"UserRefusedOnDevice\"); // TODO rename because it's just for transaction refusal\nexport var TransportOpenUserCancelled = createCustomErrorClass(\"TransportOpenUserCancelled\");\nexport var TransportInterfaceNotAvailable = createCustomErrorClass(\"TransportInterfaceNotAvailable\");\nexport var TransportRaceCondition = createCustomErrorClass(\"TransportRaceCondition\");\nexport var TransportWebUSBGestureRequired = createCustomErrorClass(\"TransportWebUSBGestureRequired\");\nexport var DeviceShouldStayInApp = createCustomErrorClass(\"DeviceShouldStayInApp\");\nexport var WebsocketConnectionError = createCustomErrorClass(\"WebsocketConnectionError\");\nexport var WebsocketConnectionFailed = createCustomErrorClass(\"WebsocketConnectionFailed\");\nexport var WrongDeviceForAccount = createCustomErrorClass(\"WrongDeviceForAccount\");\nexport var WrongAppForCurrency = createCustomErrorClass(\"WrongAppForCurrency\");\nexport var ETHAddressNonEIP = createCustomErrorClass(\"ETHAddressNonEIP\");\nexport var CantScanQRCode = createCustomErrorClass(\"CantScanQRCode\");\nexport var FeeNotLoaded = createCustomErrorClass(\"FeeNotLoaded\");\nexport var FeeRequired = createCustomErrorClass(\"FeeRequired\");\nexport var FeeTooHigh = createCustomErrorClass(\"FeeTooHigh\");\nexport var SyncError = createCustomErrorClass(\"SyncError\");\nexport var PairingFailed = createCustomErrorClass(\"PairingFailed\");\nexport var GenuineCheckFailed = createCustomErrorClass(\"GenuineCheckFailed\");\nexport var LedgerAPI4xx = createCustomErrorClass(\"LedgerAPI4xx\");\nexport var LedgerAPI5xx = createCustomErrorClass(\"LedgerAPI5xx\");\nexport var FirmwareOrAppUpdateRequired = createCustomErrorClass(\"FirmwareOrAppUpdateRequired\");\n// db stuff, no need to translate\nexport var NoDBPathGiven = createCustomErrorClass(\"NoDBPathGiven\");\nexport var DBWrongPassword = createCustomErrorClass(\"DBWrongPassword\");\nexport var DBNotReset = createCustomErrorClass(\"DBNotReset\");\n/**\n * TransportError is used for any generic transport errors.\n * e.g. Error thrown when data received by exchanges are incorrect or if exchanged failed to communicate with the device for various reason.\n */\nexport function TransportError(message, id) {\n    this.name = \"TransportError\";\n    this.message = message;\n    this.stack = new Error().stack;\n    this.id = id;\n}\nTransportError.prototype = new Error();\naddCustomErrorDeserializer(\"TransportError\", function (e) { return new TransportError(e.message, e.id); });\nexport var StatusCodes = {\n    PIN_REMAINING_ATTEMPTS: 0x63c0,\n    INCORRECT_LENGTH: 0x6700,\n    MISSING_CRITICAL_PARAMETER: 0x6800,\n    COMMAND_INCOMPATIBLE_FILE_STRUCTURE: 0x6981,\n    SECURITY_STATUS_NOT_SATISFIED: 0x6982,\n    CONDITIONS_OF_USE_NOT_SATISFIED: 0x6985,\n    INCORRECT_DATA: 0x6a80,\n    NOT_ENOUGH_MEMORY_SPACE: 0x6a84,\n    REFERENCED_DATA_NOT_FOUND: 0x6a88,\n    FILE_ALREADY_EXISTS: 0x6a89,\n    INCORRECT_P1_P2: 0x6b00,\n    INS_NOT_SUPPORTED: 0x6d00,\n    CLA_NOT_SUPPORTED: 0x6e00,\n    TECHNICAL_PROBLEM: 0x6f00,\n    OK: 0x9000,\n    MEMORY_PROBLEM: 0x9240,\n    NO_EF_SELECTED: 0x9400,\n    INVALID_OFFSET: 0x9402,\n    FILE_NOT_FOUND: 0x9404,\n    INCONSISTENT_FILE: 0x9408,\n    ALGORITHM_NOT_SUPPORTED: 0x9484,\n    INVALID_KCV: 0x9485,\n    CODE_NOT_INITIALIZED: 0x9802,\n    ACCESS_CONDITION_NOT_FULFILLED: 0x9804,\n    CONTRADICTION_SECRET_CODE_STATUS: 0x9808,\n    CONTRADICTION_INVALIDATION: 0x9810,\n    CODE_BLOCKED: 0x9840,\n    MAX_VALUE_REACHED: 0x9850,\n    GP_AUTH_FAILED: 0x6300,\n    LICENSING: 0x6f42,\n    HALTED: 0x6faa\n};\nexport function getAltStatusMessage(code) {\n    switch (code) {\n        // improve text of most common errors\n        case 0x6700:\n            return \"Incorrect length\";\n        case 0x6800:\n            return \"Missing critical parameter\";\n        case 0x6982:\n            return \"Security not satisfied (dongle locked or have invalid access rights)\";\n        case 0x6985:\n            return \"Condition of use not satisfied (denied by the user?)\";\n        case 0x6a80:\n            return \"Invalid data received\";\n        case 0x6b00:\n            return \"Invalid parameter received\";\n    }\n    if (0x6f00 <= code && code <= 0x6fff) {\n        return \"Internal error, please report\";\n    }\n}\n/**\n * Error thrown when a device returned a non success status.\n * the error.statusCode is one of the `StatusCodes` exported by this library.\n */\nexport function TransportStatusError(statusCode) {\n    this.name = \"TransportStatusError\";\n    var statusText = Object.keys(StatusCodes).find(function (k) { return StatusCodes[k] === statusCode; }) ||\n        \"UNKNOWN_ERROR\";\n    var smsg = getAltStatusMessage(statusCode) || statusText;\n    var statusCodeStr = statusCode.toString(16);\n    this.message = \"Ledger device: \" + smsg + \" (0x\" + statusCodeStr + \")\";\n    this.stack = new Error().stack;\n    this.statusCode = statusCode;\n    this.statusText = statusText;\n}\nTransportStatusError.prototype = new Error();\naddCustomErrorDeserializer(\"TransportStatusError\", function (e) { return new TransportStatusError(e.statusCode); });\n//# sourceMappingURL=index.js.map","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"semver\");","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar _a;\nimport semver from \"semver\";\n/**\n * The USB product IDs will be defined as MMII, encoding a model (MM) and an interface bitfield (II)\n *\n ** Model\n * Ledger Nano S : 0x10\n * Ledger Blue : 0x00\n * Ledger Nano X : 0x40\n *\n ** Interface support bitfield\n * Generic HID : 0x01\n * Keyboard HID : 0x02\n * U2F : 0x04\n * CCID : 0x08\n * WebUSB : 0x10\n */\nexport var IIGenericHID = 0x01;\nexport var IIKeyboardHID = 0x02;\nexport var IIU2F = 0x04;\nexport var IICCID = 0x08;\nexport var IIWebUSB = 0x10;\nexport var DeviceModelId;\n(function (DeviceModelId) {\n    DeviceModelId[\"blue\"] = \"blue\";\n    DeviceModelId[\"nanoS\"] = \"nanoS\";\n    DeviceModelId[\"nanoSP\"] = \"nanoSP\";\n    DeviceModelId[\"nanoX\"] = \"nanoX\";\n})(DeviceModelId || (DeviceModelId = {}));\nvar devices = (_a = {},\n    _a[DeviceModelId.blue] = {\n        id: DeviceModelId.blue,\n        productName: \"Ledger Blue\",\n        productIdMM: 0x00,\n        legacyUsbProductId: 0x0000,\n        usbOnly: true,\n        memorySize: 480 * 1024,\n        masks: [0x31000000, 0x31010000],\n        getBlockSize: function (_firwareVersion) { return 4 * 1024; }\n    },\n    _a[DeviceModelId.nanoS] = {\n        id: DeviceModelId.nanoS,\n        productName: \"Ledger Nano S\",\n        productIdMM: 0x10,\n        legacyUsbProductId: 0x0001,\n        usbOnly: true,\n        memorySize: 320 * 1024,\n        masks: [0x31100000],\n        getBlockSize: function (firmwareVersion) {\n            var _a;\n            return semver.lt((_a = semver.coerce(firmwareVersion)) !== null && _a !== void 0 ? _a : \"\", \"2.0.0\")\n                ? 4 * 1024\n                : 2 * 1024;\n        }\n    },\n    _a[DeviceModelId.nanoSP] = {\n        id: DeviceModelId.nanoSP,\n        productName: \"Ledger Nano SP\",\n        productIdMM: 0x50,\n        legacyUsbProductId: 0x0005,\n        usbOnly: true,\n        memorySize: 1533 * 1024,\n        masks: [0x33100000],\n        getBlockSize: function (_firmwareVersion) { return 512; }\n    },\n    _a[DeviceModelId.nanoX] = {\n        id: DeviceModelId.nanoX,\n        productName: \"Ledger Nano X\",\n        productIdMM: 0x40,\n        legacyUsbProductId: 0x0004,\n        usbOnly: false,\n        memorySize: 2 * 1024 * 1024,\n        masks: [0x33000000],\n        getBlockSize: function (_firwareVersion) { return 4 * 1024; },\n        bluetoothSpec: [\n            {\n                // this is the legacy one (prototype version). we will eventually drop it.\n                serviceUuid: \"d973f2e0-b19e-11e2-9e96-0800200c9a66\",\n                notifyUuid: \"d973f2e1-b19e-11e2-9e96-0800200c9a66\",\n                writeUuid: \"d973f2e2-b19e-11e2-9e96-0800200c9a66\"\n            },\n            {\n                serviceUuid: \"13d63400-2c97-0004-0000-4c6564676572\",\n                notifyUuid: \"13d63400-2c97-0004-0001-4c6564676572\",\n                writeUuid: \"13d63400-2c97-0004-0002-4c6564676572\"\n            },\n        ]\n    },\n    _a);\nvar productMap = {\n    Blue: DeviceModelId.blue,\n    \"Nano S\": DeviceModelId.nanoS,\n    \"Nano X\": DeviceModelId.nanoX\n};\nvar devicesList = Object.values(devices);\n/**\n *\n */\nexport var ledgerUSBVendorId = 0x2c97;\n/**\n *\n */\nexport var getDeviceModel = function (id) {\n    var info = devices[id];\n    if (!info)\n        throw new Error(\"device '\" + id + \"' does not exist\");\n    return info;\n};\n/**\n * Given a `targetId`, return the deviceModel associated to it,\n * based on the first two bytes.\n */\nexport var identifyTargetId = function (targetId) {\n    var deviceModel = devicesList.find(function (_a) {\n        var masks = _a.masks;\n        return masks.find(function (mask) { return (targetId & 0xffff0000) === mask; });\n    });\n    return deviceModel;\n};\n/**\n *\n */\nexport var identifyUSBProductId = function (usbProductId) {\n    var legacy = devicesList.find(function (d) { return d.legacyUsbProductId === usbProductId; });\n    if (legacy)\n        return legacy;\n    var mm = usbProductId >> 8;\n    var deviceModel = devicesList.find(function (d) { return d.productIdMM === mm; });\n    return deviceModel;\n};\nexport var identifyProductName = function (productName) {\n    var productId = productMap[productName];\n    if (!productId && productName.startsWith(\"Nano S\")) {\n        productId = DeviceModelId.nanoSP;\n    }\n    var deviceModel = devicesList.find(function (d) { return d.id === productId; });\n    return deviceModel;\n};\nvar bluetoothServices = [];\nvar serviceUuidToInfos = {};\nfor (var id in devices) {\n    var deviceModel = devices[id];\n    var bluetoothSpec = deviceModel.bluetoothSpec;\n    if (bluetoothSpec) {\n        for (var i = 0; i < bluetoothSpec.length; i++) {\n            var spec = bluetoothSpec[i];\n            bluetoothServices.push(spec.serviceUuid);\n            serviceUuidToInfos[spec.serviceUuid] = serviceUuidToInfos[spec.serviceUuid.replace(/-/g, \"\")] = __assign({ deviceModel: deviceModel }, spec);\n        }\n    }\n}\n/**\n *\n */\nexport var getBluetoothServiceUuids = function () { return bluetoothServices; };\n/**\n *\n */\nexport var getInfosForServiceUuid = function (uuid) { return serviceUuidToInfos[uuid.toLowerCase()]; };\n//# sourceMappingURL=index.js.map"],"names":["module","exports","require","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","iterator","this","v","op","TypeError","pop","length","push","__read","m","i","ar","error","splitPath","path","split","forEach","element","number","parseInt","isNaN","Tezos","transport","decorateAppAPIMethods","getAddress","options","ins","p2","paths","buffer","payload","publicKeyLength","publicKey","_a","verify","curve","Buffer","alloc","index","writeUInt32BE","send","Error","slice","toString","address","encodeAddress","signOperation","rawTxHex","offset","rawTx","toSend","buffer_1","chunkSize","response","data","code","from","copy","signature","getVersion","appFlag","major","minor","patch","_b","bakingApp","compressPublicKeySECP256","concat","curves","pkB58Prefix","pkhB58Prefix","compressPublicKey","curveData","hash","update","digest","__spreadArray","to","pack","arguments","l","Array","Transport","_this","exchangeTimeout","unresponsiveTimeout","deviceModel","_events","cla","p1","statusList","StatusCodes","sw","TransportError","exchange","readUInt16BE","some","s","TransportStatusError","exchangeAtomicImpl","resolveBusy","busyPromise","unresponsiveReached","timeout","res","exchangeBusyPromise","TransportRaceCondition","setTimeout","emit","clearTimeout","_appAPIlock","_apdu","setScrambleKey","_key","close","on","eventName","cb","off","removeListener","event","args","_i","setDebugMode","console","warn","setExchangeTimeout","setExchangeUnresponsiveTimeout","create","openTimeout","listenTimeout","found","sub","listen","unsubscribe","listenTimeoutId","open","descriptor","complete","ErrorMessage_NoDeviceFound","ErrorMessage_ListenTimeout","self","methods","scrambleKey","e_1","methods_1","__values","methods_1_1","methodName","decorateAppAPIMethod","e_1_1","ctx","message","log","extendStatics","POWERED_ON","availability","Observable","observer","onAvailabilityChanged","connectDevice","device","connect","disconnectDevice","disconnect","discoverDeviceServices","discoverServices","services","discoverServiceCharacteristics","service","discoverCharacteristics","chs","retrieveServiceAndCharacteristics","infos","characteristics","writeC","notifyC","characteristics_1","characteristics_1_1","c","_c","getInfosForServiceUuid","uuid","writeUuid","replace","notifyUuid","write","writeCharacteristic","__extends","b","setPrototypeOf","__proto__","p","String","__","constructor","transportsCache","reconnectionConfig","pairingThreshold","delayAfterFirstPairing","deviceOrId","needsReconnect","observable","monitoringReady","notifyObservable","notif","onDisconnect","disconnectedSub","beforeMTUTime","afterMTUTime","CantOpenDevice","pipe","first","enabled","toPromise","state","isDeviceDisconnected","characteristic","readyness","rej","onCharacteristicValueChanged","subscribe","tap","share","BluetoothTransport","notYetDisconnected","id","addListener","listenDeviceDisconnect","Date","now","inferMTU","ms","success","_super","mtuSize","apdu","msgIn","msgOut","merge","receiveAPDU","sendAPDU","e_2","DisconnectedDeviceDuringOperation","discoveredDevices","onDiscover","peripheral","name","advertisement","localName","type","getBluetoothServiceUuids","mtu","e_3","readUInt8","map","defer","ignoreElements","isSupported","list","errorClasses","deserializers","addCustomErrorDeserializer","deserializer","createCustomErrorClass","C","fields","assign","stack","PIN_REMAINING_ATTEMPTS","INCORRECT_LENGTH","MISSING_CRITICAL_PARAMETER","COMMAND_INCOMPATIBLE_FILE_STRUCTURE","SECURITY_STATUS_NOT_SATISFIED","CONDITIONS_OF_USE_NOT_SATISFIED","INCORRECT_DATA","NOT_ENOUGH_MEMORY_SPACE","REFERENCED_DATA_NOT_FOUND","FILE_ALREADY_EXISTS","INCORRECT_P1_P2","INS_NOT_SUPPORTED","CLA_NOT_SUPPORTED","TECHNICAL_PROBLEM","OK","MEMORY_PROBLEM","NO_EF_SELECTED","INVALID_OFFSET","FILE_NOT_FOUND","INCONSISTENT_FILE","ALGORITHM_NOT_SUPPORTED","INVALID_KCV","CODE_NOT_INITIALIZED","ACCESS_CONDITION_NOT_FULFILLED","CONTRADICTION_SECRET_CODE_STATUS","CONTRADICTION_INVALIDATION","CODE_BLOCKED","MAX_VALUE_REACHED","GP_AUTH_FAILED","LICENSING","HALTED","statusCode","statusText","keys","find","k","smsg","getAltStatusMessage","statusCodeStr","DeviceModelId","__assign","IIGenericHID","IIKeyboardHID","IIU2F","IICCID","IIWebUSB","devices","blue","productName","productIdMM","legacyUsbProductId","usbOnly","memorySize","masks","getBlockSize","_firwareVersion","nanoS","firmwareVersion","nanoSP","_firmwareVersion","nanoX","bluetoothSpec","serviceUuid","productMap","Blue","devicesList","values","ledgerUSBVendorId","getDeviceModel","info","identifyTargetId","targetId","mask","identifyUSBProductId","usbProductId","legacy","mm","identifyProductName","productId","startsWith","bluetoothServices","serviceUuidToInfos","spec","toLowerCase"],"sourceRoot":""}