var ledgerjs;(()=>{"use strict";var e={114:e=>{e.exports=require("@ledgerhq/errors")},871:e=>{e.exports=require("buffer")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{const e=require("invariant");var t=n.n(e);const r=require("bs58check");var o=n.n(r);const i=require("blake2b");var a=n.n(i),c=n(871).Buffer,u=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}u((r=r.apply(e,t||[])).next())}))},s=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},l=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};function d(e){var t=[];return e.split("/").forEach((function(e){var n=parseInt(e,10);isNaN(n)||(e.length>1&&"'"===e[e.length-1]&&(n+=2147483648),t.push(n))})),t}!function(){function e(e){this.transport=e,e.decorateAppAPIMethods(this,["getAddress","signOperation","getVersion"],"XTZ")}e.prototype.getAddress=function(e,t){return void 0===t&&(t={}),u(this,void 0,void 0,(function(){var n,r,o,i,a,u,l;return s(this,(function(s){switch(s.label){case 0:return(n=t.ins)||(n=t.verify?3:2),r=t.curve||0,o=d(e),(i=c.alloc(1+4*o.length))[0]=o.length,o.forEach((function(e,t){i.writeUInt32BE(e,1+4*t)})),[4,this.transport.send(128,n,0,r,i)];case 1:if(a=s.sent(),!(u=a[0]))throw new Error("invalid public key");return[2,{publicKey:(l=a.slice(1,1+u)).toString("hex"),address:h(l,r)}]}}))}))},e.prototype.signOperation=function(e,n,r){return void 0===r&&(r={}),u(this,void 0,void 0,(function(){var o,i,a,u,l,f,p,h,v,b,g,y;return s(this,(function(s){switch(s.label){case 0:for(o=r.curve||0,i=d(e),a=0,u=c.from(n,"hex"),l=[],(f=c.alloc(4*i.length+1))[0]=i.length,i.forEach((function(e,t){f.writeUInt32BE(e,1+4*t)})),l.push(f);a!==u.length;)void 0,p=a+230>=u.length?u.length-a:230,h=c.alloc(p),u.copy(h,0,a,a+p),l.push(h),a+=p;b=0,s.label=1;case 1:return b<l.length?(g=l[b],y=1,0===b?y=0:b===l.length-1&&(y=129),[4,this.transport.send(128,4,y,o,g)]):[3,4];case 2:v=s.sent(),s.label=3;case 3:return b++,[3,1];case 4:return t()(v,"hw-app-xtz: response is set"),[2,{signature:v.slice(0,v.length-2).toString("hex")}]}}))}))},e.prototype.getVersion=function(){return u(this,void 0,void 0,(function(){var e,t,n,r,o;return s(this,(function(i){switch(i.label){case 0:return[4,this.transport.send(128,0,0,0,c.alloc(0))];case 1:return e=l.apply(void 0,[i.sent(),4]),t=e[0],n=e[1],r=e[2],o=e[3],[2,{major:n,minor:r,patch:o,bakingApp:1===t}]}}))}))}}();var f=function(e,t){return c.concat([c.from([t,2+(1&e[64])]),e.slice(1,33)])},p=[{pkB58Prefix:c.from([13,15,37,217]),pkhB58Prefix:c.from([6,161,159]),compressPublicKey:function(e,t){return(e=e.slice(0))[0]=t,e}},{pkB58Prefix:c.from([3,254,226,86]),pkhB58Prefix:c.from([6,161,161]),compressPublicKey:f},{pkB58Prefix:c.from([3,178,139,127]),pkhB58Prefix:c.from([6,161,164]),compressPublicKey:f}],h=function(e,n){var r=p[n];t()(r,"%s curve not supported",n);var i=r.compressPublicKey(e,n).slice(1),u=a()(20);return u.update(i),u.digest(u=c.alloc(20)),o().encode(c.concat([r.pkhB58Prefix,u]))}})(),(()=>{const e=require("events");var t=n.n(e),r=n(114),o=n(871).Buffer,i=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}u((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},c=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},u=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};!function(){function e(){var e=this;this.exchangeTimeout=3e4,this.unresponsiveTimeout=15e3,this.deviceModel=null,this._events=new(t()),this.send=function(t,n,c,u,s,l){return void 0===s&&(s=o.alloc(0)),void 0===l&&(l=[r.StatusCodes.OK]),i(e,void 0,void 0,(function(){var e,i;return a(this,(function(a){switch(a.label){case 0:if(s.length>=256)throw new r.TransportError("data.length exceed 256 bytes limit. Got: "+s.length,"DataLengthTooBig");return[4,this.exchange(o.concat([o.from([t,n,c,u]),o.from([s.length]),s]))];case 1:if(e=a.sent(),i=e.readUInt16BE(e.length-2),!l.some((function(e){return e===i})))throw new r.TransportStatusError(i);return[2,e]}}))}))},this.exchangeAtomicImpl=function(t){return i(e,void 0,void 0,(function(){var e,n,o,i,c,u=this;return a(this,(function(a){switch(a.label){case 0:if(this.exchangeBusyPromise)throw new r.TransportRaceCondition("An action was already pending on the Ledger device. Please deny or reconnect.");n=new Promise((function(t){e=t})),this.exchangeBusyPromise=n,o=!1,i=setTimeout((function(){o=!0,u.emit("unresponsive")}),this.unresponsiveTimeout),a.label=1;case 1:return a.trys.push([1,,3,4]),[4,t()];case 2:return c=a.sent(),o&&this.emit("responsive"),[2,c];case 3:return clearTimeout(i),e&&e(),this.exchangeBusyPromise=null,[7];case 4:return[2]}}))}))},this._appAPIlock=null}e.prototype.exchange=function(e){throw new Error("exchange not implemented")},e.prototype.setScrambleKey=function(e){},e.prototype.close=function(){return Promise.resolve()},e.prototype.on=function(e,t){this._events.on(e,t)},e.prototype.off=function(e,t){this._events.removeListener(e,t)},e.prototype.emit=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];(t=this._events).emit.apply(t,u([e],c(n),!1))},e.prototype.setDebugMode=function(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")},e.prototype.setExchangeTimeout=function(e){this.exchangeTimeout=e},e.prototype.setExchangeUnresponsiveTimeout=function(e){this.unresponsiveTimeout=e},e.create=function(e,t){var n=this;return void 0===e&&(e=3e3),new Promise((function(o,i){var a=!1,c=n.listen({next:function(t){a=!0,c&&c.unsubscribe(),u&&clearTimeout(u),n.open(t.descriptor,e).then(o,i)},error:function(e){u&&clearTimeout(u),i(e)},complete:function(){u&&clearTimeout(u),a||i(new r.TransportError(n.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),u=t?setTimeout((function(){c.unsubscribe(),i(new r.TransportError(n.ErrorMessage_ListenTimeout,"ListenTimeout"))}),t):null}))},e.prototype.decorateAppAPIMethods=function(e,t,n){var r,o;try{for(var i=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),a=i.next();!a.done;a=i.next()){var c=a.value;e[c]=this.decorateAppAPIMethod(c,e[c],e,n)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}},e.prototype.decorateAppAPIMethod=function(e,t,n,o){var c=this;return function(){for(var u=[],s=0;s<arguments.length;s++)u[s]=arguments[s];return i(c,void 0,void 0,(function(){var i;return a(this,(function(a){switch(a.label){case 0:if(i=this._appAPIlock)return[2,Promise.reject(new r.TransportError("Ledger Device is busy (lock "+i+")","TransportLocked"))];a.label=1;case 1:return a.trys.push([1,,3,4]),this._appAPIlock=e,this.setScrambleKey(o),[4,t.apply(n,u)];case 2:return[2,a.sent()];case 3:return this._appAPIlock=null,[7];case 4:return[2]}}))}))}},e.ErrorMessage_ListenTimeout="No Ledger device found (timeout)",e.ErrorMessage_NoDeviceFound="No Ledger device found"}()})(),(()=>{const e=require("@ledgerhq/hw-transport");var t=n.n(e);const r=require("@ledgerhq/devices/lib/ble/sendAPDU"),o=require("@ledgerhq/devices/lib/ble/receiveAPDU"),i=require("@ledgerhq/logs"),a=require("rxjs"),c=require("rxjs/operators");var u=n(114);const s=require("@abandonware/noble");var l=n.n(s);const d=require("@ledgerhq/devices");var f=n(871).Buffer,p=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};l().on("warning",(function(e){(0,i.log)("ble-warning",e)}));var h,v="poweredOn",b=a.Observable.create((function(e){var t=function(t){e.next(t===v)};return l().on("stateChanged",t),e.next(l().state===v),function(){l().removeListener("stateChanged",t)}})),g=function(e){return new Promise((function(t,n){e.connect((function(e){e?n(e):t()}))}))},y=function(e){return new Promise((function(t,n){e.disconnect((function(e){e?n(e):t()}))}))},m=function(e){return new Promise((function(t,n){return e.discoverServices(null,(function(e,r){e?n(e):t(r)}))}))},w=function(e){return new Promise((function(t,n){return e.discoverCharacteristics(null,(function(e,r){e?n(e):t(r)}))}))},S=function(e){return t=void 0,n=void 0,o=function(){var t,n,r,o,i,a,c,s,l,f,h;return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(v){switch(v.label){case 0:return[4,m(e)];case 1:if(t=p.apply(void 0,[v.sent(),1]),n=t[0],!(r=(0,d.getInfosForServiceUuid)(n.uuid)))throw new u.TransportError("service not found","BLEServiceNotFound");return[4,w(n)];case 2:o=v.sent();try{for(c=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(o),s=c.next();!s.done;s=c.next())(l=s.value).uuid===r.writeUuid.replace(/-/g,"")?i=l:l.uuid===r.notifyUuid.replace(/-/g,"")&&(a=l)}catch(e){f={error:e}}finally{try{s&&!s.done&&(h=c.return)&&h.call(c)}finally{if(f)throw f.error}}if(!i||!a)throw new u.TransportError("missing characteristics","BLEMissingCharacteristics");return[2,{writeC:i,notifyC:a,deviceModel:r.deviceModel}]}}))},new((r=void 0)||(r=Promise))((function(e,i){function a(e){try{u(o.next(e))}catch(e){i(e)}}function c(e){try{u(o.throw(e))}catch(e){i(e)}}function u(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,c)}u((o=o.apply(t,n||[])).next())}));var t,n,r,o},E=function(e,t){return new Promise((function(n,r){e.write(t,!1,(function(e){e?r(e):n()}))}))},T=n(871).Buffer,I=(h=function(e,t){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},h(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}h(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),A=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}u((r=r.apply(e,t||[])).next())}))},P=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},N={},D={pairingThreshold:1e3,delayAfterFirstPairing:4e3};function O(e,t){return A(this,void 0,void 0,(function(){var n,r,o,s,l,d,p,h,v,m,w,E,T,I,A;return P(this,(function(P){switch(P.label){case 0:if("string"==typeof e){if(N[e])return(0,i.log)("ble-verbose","Transport in cache, using that."),[2,N[e]]}else n=e;if(!n)throw new u.CantOpenDevice;return[4,b.pipe((0,c.first)((function(e){return e}))).toPromise()];case 1:return P.sent(),function(e){return"disconnected"===e.state}(n)?((0,i.log)("ble-verbose","not connected. connecting..."),[4,g(n)]):[3,3];case 2:P.sent(),P.label=3;case 3:return[4,S(n)];case 4:r=P.sent(),o=r.notifyC,s=r.writeC,l=r.deviceModel,d=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}((U=o,k=new Promise((function(e,t){C=e,M=t})),[a.Observable.create((function(e){function t(t){e.next(f.from(t))}return U.on("data",t),U.subscribe((function(t){t?(M(t),e.error(t)):(C(),(0,i.log)("verbose","start monitor "+U.uuid))})),function(){(0,i.log)("verbose","end monitor "+U.uuid),U.removeListener("data",t),U.unsubscribe()}})),k]),2),p=d[0],h=d[1],v=p.pipe((0,c.tap)((function(e){(0,i.log)("ble-frame","<= "+e.toString("hex"))})),(0,c.share)()),m=v.subscribe(),w=new x(n,s,v,l),E=function(e){w.notYetDisconnected=!1,m.unsubscribe(),T(),delete N[w.id],(0,i.log)("ble-verbose","BleTransport("+w.id+") disconnected"),w.emit("disconnect",e)},N[w.id]=w,T=function(e,t){return e.addListener("disconnect",t),function(){e.removeListener("disconnect",t)}}(n,(function(e){w.notYetDisconnected&&E(e)})),I=Date.now(),P.label=5;case 5:return P.trys.push([5,,8,14]),[4,h];case 6:return P.sent(),[4,w.inferMTU()];case 7:return P.sent(),[3,14];case 8:return A=Date.now(),D?(A-I<D.pairingThreshold&&(t=!1),t?[4,y(n).catch((function(){}))]:[3,11]):[3,12];case 9:return P.sent(),[4,(_=D.delayAfterFirstPairing,new Promise((function(e){return setTimeout(e,_)})))];case 10:P.sent(),P.label=11;case 11:return[3,13];case 12:t=!1,P.label=13;case 13:return[7];case 14:return t?[2,O(n,!1)]:[2,w]}var _,U,C,M,k}))}))}var x=function(e){function t(t,n,c,s){var l=e.call(this)||this;return l.mtuSize=20,l.notYetDisconnected=!0,l.exchange=function(e){return l.exchangeAtomicImpl((function(){return A(l,void 0,void 0,(function(){var t,n,c,u;return P(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,5]),t=e.toString("hex"),(0,i.log)("apdu","=> "+t),[4,(0,a.merge)(this.notifyObservable.pipe(o.receiveAPDU),(0,r.sendAPDU)(this.write,e,this.mtuSize)).toPromise()];case 1:return n=s.sent(),c=n.toString("hex"),(0,i.log)("apdu","<= "+c),[2,n];case 2:return u=s.sent(),(0,i.log)("ble-error","exchange got "+String(u)),this.notYetDisconnected?[4,y(this.device).catch((function(){}))]:[3,4];case 3:s.sent(),s.label=4;case 4:throw u;case 5:return[2]}}))}))}))},l.write=function(e){return A(l,void 0,void 0,(function(){var t;return P(this,(function(n){switch(n.label){case 0:(0,i.log)("ble-frame","=> "+e.toString("hex")),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,E(this.writeCharacteristic,e)];case 2:return n.sent(),[3,4];case 3:throw t=n.sent(),new u.DisconnectedDeviceDuringOperation(t.message);case 4:return[2]}}))}))},l.id=t.id,l.device=t,l.writeCharacteristic=n,l.notifyObservable=c,l.deviceModel=s,(0,i.log)("ble-verbose","BleTransport("+String(l.id)+") new instance"),l}var n;return I(t,e),t.listen=function(e){return(0,i.log)("ble-verbose","listen..."),a.Observable.create((function(e){var t={},n=function(n){var r=n.uuid,o=n.advertisement.localName||(t[r]?t[r].name:null);t[r]={peripheral:n,name:o},(0,i.log)("ble-advertisement",r+" ("+String(o)+")"),e.next({type:"add",descriptor:n,device:{id:r,name:o}})};return l().on("discover",n),l().startScanning((0,d.getBluetoothServiceUuids)(),!0),function(){l().removeListener("discover",n),l().stopScanning()}})).subscribe(e)},t.open=function(e){return A(this,void 0,void 0,(function(){return P(this,(function(t){return[2,O(e,!0)]}))}))},t.prototype.inferMTU=function(){return A(this,void 0,void 0,(function(){var e,t,n=this;return P(this,(function(r){switch(r.label){case 0:return e=this.device.mtu,[4,this.exchangeAtomicImpl((function(){return A(n,void 0,void 0,(function(){var t,n=this;return P(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,4]),[4,(0,a.merge)(this.notifyObservable.pipe((0,c.first)((function(e){return 8===e.readUInt8(0)})),(0,c.map)((function(e){return e.readUInt8(5)}))),(0,a.defer)((function(){return(0,a.from)(n.write(T.from([8,0,0,0,0])))})).pipe((0,c.ignoreElements)())).toPromise()];case 1:return e=r.sent()+3,[3,4];case 2:return t=r.sent(),(0,i.log)("ble-error","inferMTU got "+String(t)),[4,y(this.device).catch((function(){}))];case 3:throw r.sent(),t;case 4:return[2]}}))}))}))];case 1:return r.sent(),e>23&&(t=e-3,(0,i.log)("ble-verbose","BleTransport("+String(this.id)+") mtu set to "+String(t)),this.mtuSize=t),[2,this.mtuSize]}}))}))},t.prototype.setScrambleKey=function(){},t.prototype.close=function(){return A(this,void 0,void 0,(function(){return P(this,(function(e){switch(e.label){case 0:return this.exchangeBusyPromise?[4,this.exchangeBusyPromise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},n=t,t.isSupported=function(){return Promise.resolve(!0)},t.availability=b,t.list=function(){throw new Error("not implemented")},t.disconnect=function(e){return A(void 0,void 0,void 0,(function(){return P(n,(function(t){return(0,i.log)("ble-verbose","user disconnect("+e+")"),e in N&&y(N[e].device),[2]}))}))},t}(t())})(),(()=>{var e={},t={},n=function(e,n){t[e]=n},r=function(t){var n=function(e,n){Object.assign(this,n),this.name=t,this.message=e||t,this.stack=(new Error).stack};return n.prototype=new Error,e[t]=n,n};function o(e,t){this.name="TransportError",this.message=e,this.stack=(new Error).stack,this.id=t}r("AccountNameRequired"),r("AccountNotSupported"),r("AmountRequired"),r("BluetoothRequired"),r("BtcUnmatchedApp"),r("CantOpenDevice"),r("CashAddrNotSupported"),r("CurrencyNotSupported"),r("DeviceAppVerifyNotSupported"),r("DeviceGenuineSocketEarlyClose"),r("DeviceNotGenuine"),r("DeviceOnDashboardExpected"),r("DeviceOnDashboardUnexpected"),r("DeviceInOSUExpected"),r("DeviceHalted"),r("DeviceNameInvalid"),r("DeviceSocketFail"),r("DeviceSocketNoBulkStatus"),r("DisconnectedDevice"),r("DisconnectedDeviceDuringOperation"),r("EnpointConfig"),r("EthAppPleaseEnableContractData"),r("FeeEstimationFailed"),r("FirmwareNotRecognized"),r("HardResetFail"),r("InvalidXRPTag"),r("InvalidAddress"),r("InvalidAddressBecauseDestinationIsAlsoSource"),r("LatestMCUInstalledError"),r("UnknownMCU"),r("LedgerAPIError"),r("LedgerAPIErrorWithMessage"),r("LedgerAPINotAvailable"),r("ManagerAppAlreadyInstalled"),r("ManagerAppRelyOnBTC"),r("ManagerAppDepInstallRequired"),r("ManagerAppDepUninstallRequired"),r("ManagerDeviceLocked"),r("ManagerFirmwareNotEnoughSpace"),r("ManagerNotEnoughSpace"),r("ManagerUninstallBTCDep"),r("NetworkDown"),r("NoAddressesFound"),r("NotEnoughBalance"),r("NotEnoughBalanceToDelegate"),r("NotEnoughBalanceInParentAccount"),r("NotEnoughSpendableBalance"),r("NotEnoughBalanceBecauseDestinationNotCreated"),r("NoAccessToCamera"),r("NotEnoughGas"),r("NotSupportedLegacyAddress"),r("GasLessThanEstimate"),r("PasswordsDontMatch"),r("PasswordIncorrect"),r("RecommendSubAccountsToEmpty"),r("RecommendUndelegation"),r("TimeoutTagged"),r("UnexpectedBootloader"),r("MCUNotGenuineToDashboard"),r("RecipientRequired"),r("UnavailableTezosOriginatedAccountReceive"),r("UnavailableTezosOriginatedAccountSend"),r("UpdateFetchFileFail"),r("UpdateIncorrectHash"),r("UpdateIncorrectSig"),r("UpdateYourApp"),r("UserRefusedDeviceNameChange"),r("UserRefusedAddress"),r("UserRefusedFirmwareUpdate"),r("UserRefusedAllowManager"),r("UserRefusedOnDevice"),r("TransportOpenUserCancelled"),r("TransportInterfaceNotAvailable"),r("TransportRaceCondition"),r("TransportWebUSBGestureRequired"),r("DeviceShouldStayInApp"),r("WebsocketConnectionError"),r("WebsocketConnectionFailed"),r("WrongDeviceForAccount"),r("WrongAppForCurrency"),r("ETHAddressNonEIP"),r("CantScanQRCode"),r("FeeNotLoaded"),r("FeeRequired"),r("FeeTooHigh"),r("SyncError"),r("PairingFailed"),r("GenuineCheckFailed"),r("LedgerAPI4xx"),r("LedgerAPI5xx"),r("FirmwareOrAppUpdateRequired"),r("NoDBPathGiven"),r("DBWrongPassword"),r("DBNotReset"),o.prototype=new Error,n("TransportError",(function(e){return new o(e.message,e.id)}));var i={PIN_REMAINING_ATTEMPTS:25536,INCORRECT_LENGTH:26368,MISSING_CRITICAL_PARAMETER:26624,COMMAND_INCOMPATIBLE_FILE_STRUCTURE:27009,SECURITY_STATUS_NOT_SATISFIED:27010,CONDITIONS_OF_USE_NOT_SATISFIED:27013,INCORRECT_DATA:27264,NOT_ENOUGH_MEMORY_SPACE:27268,REFERENCED_DATA_NOT_FOUND:27272,FILE_ALREADY_EXISTS:27273,INCORRECT_P1_P2:27392,INS_NOT_SUPPORTED:27904,CLA_NOT_SUPPORTED:28160,TECHNICAL_PROBLEM:28416,OK:36864,MEMORY_PROBLEM:37440,NO_EF_SELECTED:37888,INVALID_OFFSET:37890,FILE_NOT_FOUND:37892,INCONSISTENT_FILE:37896,ALGORITHM_NOT_SUPPORTED:38020,INVALID_KCV:38021,CODE_NOT_INITIALIZED:38914,ACCESS_CONDITION_NOT_FULFILLED:38916,CONTRADICTION_SECRET_CODE_STATUS:38920,CONTRADICTION_INVALIDATION:38928,CODE_BLOCKED:38976,MAX_VALUE_REACHED:38992,GP_AUTH_FAILED:25344,LICENSING:28482,HALTED:28586};function a(e){this.name="TransportStatusError";var t=Object.keys(i).find((function(t){return i[t]===e}))||"UNKNOWN_ERROR",n=function(e){switch(e){case 26368:return"Incorrect length";case 26624:return"Missing critical parameter";case 27010:return"Security not satisfied (dongle locked or have invalid access rights)";case 27013:return"Condition of use not satisfied (denied by the user?)";case 27264:return"Invalid data received";case 27392:return"Invalid parameter received"}if(28416<=e&&e<=28671)return"Internal error, please report"}(e)||t,r=e.toString(16);this.message="Ledger device: "+n+" (0x"+r+")",this.stack=(new Error).stack,this.statusCode=e,this.statusText=t}a.prototype=new Error,n("TransportStatusError",(function(e){return new a(e.statusCode)}))})(),(()=>{n.r(r),n.d(r,{DeviceModelId:()=>o,IICCID:()=>l,IIGenericHID:()=>c,IIKeyboardHID:()=>u,IIU2F:()=>s,IIWebUSB:()=>d,getBluetoothServiceUuids:()=>N,getDeviceModel:()=>b,getInfosForServiceUuid:()=>D,identifyProductName:()=>m,identifyTargetId:()=>g,identifyUSBProductId:()=>y,ledgerUSBVendorId:()=>v});const e=require("semver");var t,o,i=n.n(e),a=function(){return a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},a.apply(this,arguments)},c=1,u=2,s=4,l=8,d=16;!function(e){e.blue="blue",e.nanoS="nanoS",e.nanoSP="nanoSP",e.nanoX="nanoX"}(o||(o={}));var f=((t={})[o.blue]={id:o.blue,productName:"Ledger Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:491520,masks:[822083584,822149120],getBlockSize:function(e){return 4096}},t[o.nanoS]={id:o.nanoS,productName:"Ledger Nano S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:327680,masks:[823132160],getBlockSize:function(e){var t;return i().lt(null!==(t=i().coerce(e))&&void 0!==t?t:"","2.0.0")?4096:2048}},t[o.nanoSP]={id:o.nanoSP,productName:"Ledger Nano SP",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1569792,masks:[856686592],getBlockSize:function(e){return 512}},t[o.nanoX]={id:o.nanoX,productName:"Ledger Nano X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2097152,masks:[855638016],getBlockSize:function(e){return 4096},bluetoothSpec:[{serviceUuid:"d973f2e0-b19e-11e2-9e96-0800200c9a66",notifyUuid:"d973f2e1-b19e-11e2-9e96-0800200c9a66",writeUuid:"d973f2e2-b19e-11e2-9e96-0800200c9a66"},{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572"}]},t),p={Blue:o.blue,"Nano S":o.nanoS,"Nano X":o.nanoX},h=Object.values(f),v=11415,b=function(e){var t=f[e];if(!t)throw new Error("device '"+e+"' does not exist");return t},g=function(e){var t=h.find((function(t){return t.masks.find((function(t){return(4294901760&e)===t}))}));return t},y=function(e){var t=h.find((function(t){return t.legacyUsbProductId===e}));if(t)return t;var n=e>>8;return h.find((function(e){return e.productIdMM===n}))},m=function(e){var t=p[e];return!t&&e.startsWith("Nano S")&&(t=o.nanoSP),h.find((function(e){return e.id===t}))},w=[],S={};for(var E in f){var T=f[E],I=T.bluetoothSpec;if(I)for(var A=0;A<I.length;A++){var P=I[A];w.push(P.serviceUuid),S[P.serviceUuid]=S[P.serviceUuid.replace(/-/g,"")]=a({deviceModel:T},P)}}var N=function(){return w},D=function(e){return S[e.toLowerCase()]}})(),ledgerjs=r})();
//# sourceMappingURL=ledgerjs.js.map